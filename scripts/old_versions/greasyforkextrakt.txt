Kleinanzeigen m² Preis Rechner V2.1
Zeigt den Preis pro m² (fett, groß, ohne Klammern) direkt in den Kleinanzeigen Suchergebnissen für Immobilien an. Jetzt auch für Tauschangebote.

Version vom 5. Juni. Aktuellste Version

Skript installieren?
Stellen Sie eine Frage, veröffentlichen Sie eine Bewertung oder melden Sie das Skript.
Wrap lines
// ==UserScript==
// @name         Kleinanzeigen m² Preis Rechner V2.1
// @namespace    http://tampermonkey.net/
// @version      1.3.1
// @description  Zeigt den Preis pro m² (fett, groß, ohne Klammern) direkt in den Kleinanzeigen Suchergebnissen für Immobilien an. Jetzt auch für Tauschangebote.
// @license MIT
// @author       Dein Name
// @match        https://www.kleinanzeigen.de/s-wohnung-mieten/*
// @match        https://www.kleinanzeigen.de/s-haus-mieten/*
// @match        https://www.kleinanzeigen.de/s-wohnung-kaufen/*
// @match        https://www.kleinanzeigen.de/s-haus-kaufen/*
// @match        https://www.kleinanzeigen.de/s-wg-zimmer/*
// @match        https://www.kleinanzeigen.de/s-immobilien/*
// @match        https://www.kleinanzeigen.de/s-grundstuecke-gaerten/*
// @grant        GM_addStyle
// @run-at       document-idle
// ==/UserScript==
 
(function() {
    'use strict';
 
    // CSS für die Anzeige des m²-Preises
    GM_addStyle(`
        .sqm-price-display {
            font-size: 1.4em; /* Angepasst: Größer, etwa wie der Hauptpreis */
            color: #20242C;   /* Angepasst: Farbe des Hauptpreises für Konsistenz */
            font-weight: bold;/* Angepasst: Fett */
            margin-left: 10px;/* Etwas Abstand zum Hauptpreis */
        }
        /* Stellt sicher, dass der Preis-Container den zusätzlichen Text aufnehmen kann */
        .aditem-main--middle--price-shipping {
            display: flex;
            align-items: baseline; /* Basislinien der Texte auf gleicher Höhe */
            flex-wrap: wrap;
        }
        .aditem-main--middle--price-shipping--price {
            /* Standardstyles für den Hauptpreis bleiben erhalten */
        }
        .sqm-price-container { /* Container für den m² Preis, um ihn rechts zu platzieren */
            margin-left: auto; /* Schiebt diesen Container ganz nach rechts */
            padding-left: 5px;
        }
    `);
 
    function parsePrice(priceString) {
        if (!priceString) return null;
        const cleanedPrice = priceString
            .replace(/\s*VB\s*/i, '')
            .replace(/\s*€\s*/g, '')
            .replace(/\./g, '')
            .replace(/,/g, '.')
            .trim();
        if (cleanedPrice.toLowerCase() === 'zu verschenken') return 0;
        if (cleanedPrice.toLowerCase() === 'auf anfrage' || cleanedPrice.toLowerCase() === 'anfrage') return null;
        const price = parseFloat(cleanedPrice);
        return isNaN(price) ? null : price;
    }
 
    function parseArea(areaString) {
        if (!areaString) return null;
        const match = areaString.match(/([\d\.,]+)\s*m²/i);
        if (match && match[1]) {
            const cleanedArea = match[1].replace(/\./g, '').replace(/,/g, '.');
            const area = parseFloat(cleanedArea);
            return isNaN(area) || area === 0 ? null : area;
        }
        return null;
    }
 
    function processAdItems() {
        const items = document.querySelectorAll('article.aditem');
 
        items.forEach(item => {
            const priceShippingContainer = item.querySelector('.aditem-main--middle--price-shipping');
            if (!priceShippingContainer) return;
 
            if (priceShippingContainer.querySelector('.sqm-price-container')) {
                return;
            }
 
            const priceElement = priceShippingContainer.querySelector('.aditem-main--middle--price-shipping--price');
            const priceText = priceElement ? priceElement.textContent : null;
 
            // *** GEÄNDERTER SELEKTOR HIER ***
            // Sucht nach einem p-Element innerhalb von .aditem-main--bottom
            const tagsContainer = item.querySelector('.aditem-main--bottom p');
            let areaText = null;
            if (tagsContainer) {
                const simpleTags = tagsContainer.querySelectorAll('span.simpletag');
                simpleTags.forEach(tag => {
                    if (tag.textContent && tag.textContent.includes('m²')) {
                        areaText = tag.textContent;
                    }
                });
            }
 
            const price = parsePrice(priceText);
            const area = parseArea(areaText);
 
            if (price !== null && area !== null && area > 0) {
                const pricePerSqm = price / area;
 
                const sqmPriceOuterContainer = document.createElement('div');
                sqmPriceOuterContainer.classList.add('sqm-price-container');
 
                const sqmPriceElement = document.createElement('span');
                sqmPriceElement.classList.add('sqm-price-display');
                sqmPriceElement.textContent = `${pricePerSqm.toFixed(2).replace('.', ',')} €/m²`;
 
                sqmPriceOuterContainer.appendChild(sqmPriceElement);
                priceShippingContainer.appendChild(sqmPriceOuterContainer);
            }
        });
    }
 
    // Führe die Funktion initial aus
    processAdItems();
 
    // MutationObserver für dynamisch geladene Inhalte
    const observerTargetNode = document.getElementById('srchrslt-adtable') || document.body;
    const observer = new MutationObserver(function(mutationsList) {
        for (const mutation of mutationsList) {
            if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                let hasNewAdItems = false;
                for (const addedNode of mutation.addedNodes) {
                    if (addedNode.nodeType === Node.ELEMENT_NODE && (addedNode.classList.contains('aditem') || addedNode.querySelector('.aditem'))) {
                        hasNewAdItems = true;
                        break;
                    }
                }
                if (hasNewAdItems) {
                    setTimeout(processAdItems, 300);
                    return;
                }
            }
        }
    });
 
    observer.observe(observerTargetNode, { childList: true, subtree: true });
 
})();



Kleinanzeigen m² Preis Rechner & Farbkodierer V3
Zeigt den Preis pro m² und färbt Anzeigen dynamisch nach €/m²-Preis (grün/gelb/rot).

Version vom 5. Juni. Aktuellste Version

Skript installieren?
Stellen Sie eine Frage, veröffentlichen Sie eine Bewertung oder melden Sie das Skript.
Wrap lines
// ==UserScript==
// @name         Kleinanzeigen m² Preis Rechner & Farbkodierer V3
// @namespace    http://tampermonkey.net/
// @version      1.4
// @description  Zeigt den Preis pro m² und färbt Anzeigen dynamisch nach €/m²-Preis (grün/gelb/rot).
// @author       Dein Name
// @license MIT 
// @match        https://www.kleinanzeigen.de/s-wohnung-mieten/*
// @match        https://www.kleinanzeigen.de/s-haus-mieten/*
// @match        https://www.kleinanzeigen.de/s-wohnung-kaufen/*
// @match        https://www.kleinanzeigen.de/s-haus-kaufen/*
// @match        https://www.kleinanzeigen.de/s-wg-zimmer/*
// @match        https://www.kleinanzeigen.de/s-immobilien/*
// @match        https://www.kleinanzeigen.de/s-grundstuecke-gaerten/*
// @grant        GM_addStyle
// @run-at       document-idle
// ==/UserScript==
 
(function() {
    'use strict';
 
    // CSS für die Anzeige des m²-Preises und die Hintergrundfarben
    GM_addStyle(`
        .sqm-price-display {
            font-size: 1.4em;
            color: #20242C;
            font-weight: bold;
            margin-left: 10px;
        }
        .aditem-main--middle--price-shipping {
            display: flex;
            align-items: baseline;
            flex-wrap: wrap;
        }
        .sqm-price-container {
            margin-left: auto;
            padding-left: 5px;
        }
 
        /* Klassen für die Hintergrundfarben der Artikel */
        .sqm-price-low { background-color: rgba(144, 238, 144, 0.4) !important; } /* Hellgrün */
        .sqm-price-medium { background-color: rgba(255, 210, 100, 0.4) !important; } /* Helles Orange/Gelb */
        .sqm-price-high { background-color: rgba(255, 127, 127, 0.4) !important; } /* Hellrot */
        .sqm-price-uniform { background-color: rgba(200, 200, 200, 0.3) !important; } /* Hellgrau, wenn alle Preise gleich */
    `);
 
    function parsePrice(priceString) {
        if (!priceString) return null;
        const cleanedPrice = priceString
            .replace(/\s*VB\s*/i, '')
            .replace(/\s*€\s*/g, '')
            .replace(/\./g, '')
            .replace(/,/g, '.')
            .trim();
        if (cleanedPrice.toLowerCase() === 'zu verschenken') return 0;
        if (cleanedPrice.toLowerCase() === 'auf anfrage' || cleanedPrice.toLowerCase() === 'anfrage') return null;
        const price = parseFloat(cleanedPrice);
        return isNaN(price) ? null : price;
    }
 
    function parseArea(areaString) {
        if (!areaString) return null;
        const match = areaString.match(/([\d\.,]+)\s*m²/i);
        if (match && match[1]) {
            const cleanedArea = match[1].replace(/\./g, '').replace(/,/g, '.');
            const area = parseFloat(cleanedArea);
            return isNaN(area) || area === 0 ? null : area;
        }
        return null;
    }
 
    function removeColorClasses(element) {
        element.classList.remove('sqm-price-low', 'sqm-price-medium', 'sqm-price-high', 'sqm-price-uniform');
    }
 
    function processAdItems() {
        const items = document.querySelectorAll('article.aditem');
        const itemsData = []; // Sammelt { element, pricePerSqm } für die aktuelle Seite
 
        // --- PASS 1: €/m² berechnen, Text anzeigen, Daten für Farbkodierung sammeln ---
        items.forEach(item => {
            // Vorherige Farbklassen vom Artikel entfernen (wichtig für Neuberechnung durch MutationObserver)
            removeColorClasses(item);
 
            const priceShippingContainer = item.querySelector('.aditem-main--middle--price-shipping');
            if (!priceShippingContainer) return;
			
			Kleinanzeigen m² Preis Rechner, Farbkodierer & Seitennavigation V4.2
Zeigt €/m², färbt Anzeigen dynamisch, und ermöglicht Seitennavigation mit 'a'/'d'. Vereinfachte Paginierungslogik.

Version vom 5. Juni. Aktuellste Version

Skript installieren?
Stellen Sie eine Frage, veröffentlichen Sie eine Bewertung oder melden Sie das Skript.
Wrap lines
// ==UserScript==
// @name         Kleinanzeigen m² Preis Rechner, Farbkodierer & Seitennavigation V4.2
// @namespace    http://tampermonkey.net/
// @version      1.5.2
// @description  Zeigt €/m², färbt Anzeigen dynamisch, und ermöglicht Seitennavigation mit 'a'/'d'. Vereinfachte Paginierungslogik.
// @author       Dein Name
// @license MIT
// @match        https://www.kleinanzeigen.de/s-wohnung-mieten/*
// @match        https://www.kleinanzeigen.de/s-haus-mieten/*
// @match        https://www.kleinanzeigen.de/s-wohnung-kaufen/*
// @match        https://www.kleinanzeigen.de/s-haus-kaufen/*
// @match        https://www.kleinanzeigen.de/s-wg-zimmer/*
// @match        https://www.kleinanzeigen.de/s-immobilien/*
// @match        https://www.kleinanzeigen.de/s-grundstuecke-gaerten/*
// @grant        GM_addStyle
// @run-at       document-idle
// ==/UserScript==
 
(function() {
    'use strict';
 
    // CSS (unverändert)
    GM_addStyle(`
        .sqm-price-display { font-size: 1.4em; color: #20242C; font-weight: bold; margin-left: 10px; }
        .aditem-main--middle--price-shipping { display: flex; align-items: baseline; flex-wrap: wrap; }
        .sqm-price-container { margin-left: auto; padding-left: 5px; }
        .sqm-price-low { background-color: rgba(144, 238, 144, 0.4) !important; }
        .sqm-price-medium { background-color: rgba(255, 210, 100, 0.4) !important; }
        .sqm-price-high { background-color: rgba(255, 127, 127, 0.4) !important; }
        .sqm-price-uniform { background-color: rgba(200, 200, 200, 0.3) !important; }
    `);
 
    function parsePrice(priceString) { // (unverändert)
        if (!priceString) return null;
        const cleanedPrice = priceString.replace(/\s*VB\s*/i, '').replace(/\s*€\s*/g, '').replace(/\./g, '').replace(/,/g, '.').trim();
        if (cleanedPrice.toLowerCase() === 'zu verschenken') return 0;
        if (cleanedPrice.toLowerCase() === 'auf anfrage' || cleanedPrice.toLowerCase() === 'anfrage') return null;
        const price = parseFloat(cleanedPrice);
        return isNaN(price) ? null : price;
    }
 
    function parseArea(areaString) { // (unverändert)
        if (!areaString) return null;
        const match = areaString.match(/([\d\.,]+)\s*m²/i);
        if (match && match[1]) {
            const cleanedArea = match[1].replace(/\./g, '').replace(/,/g, '.');
            const area = parseFloat(cleanedArea);
            return isNaN(area) || area === 0 ? null : area;
        }
        return null;
    }
 
    function removeColorClasses(element) { // (unverändert)
        element.classList.remove('sqm-price-low', 'sqm-price-medium', 'sqm-price-high', 'sqm-price-uniform');
    }
 
    function processAdItems() { // (unverändert, Logik zur Preisberechnung und Farbkodierung)
        const items = document.querySelectorAll('article.aditem');
        const itemsData = [];
        items.forEach(item => {
            removeColorClasses(item);
            const priceShippingContainer = item.querySelector('.aditem-main--middle--price-shipping');
            if (!priceShippingContainer) return;
            const existingSqmTextContainer = priceShippingContainer.querySelector('.sqm-price-container');
            if (existingSqmTextContainer) existingSqmTextContainer.remove();
            const priceElement = priceShippingContainer.querySelector('.aditem-main--middle--price-shipping--price');
            const priceText = priceElement ? priceElement.textContent : null;
            const tagsContainer = item.querySelector('.aditem-main--bottom p');
            let areaText = null;
            if (tagsContainer) {
                const simpleTags = tagsContainer.querySelectorAll('span.simpletag');
                simpleTags.forEach(tag => { if (tag.textContent && tag.textContent.includes('m²')) areaText = tag.textContent; });
            }
            const price = parsePrice(priceText);
            const area = parseArea(areaText);
            if (price !== null && area !== null && area > 0) {
                const pricePerSqm = price / area;
                itemsData.push({ element: item, pricePerSqm: pricePerSqm });
                const sqmPriceOuterContainer = document.createElement('div');
                sqmPriceOuterContainer.classList.add('sqm-price-container');
                const sqmPriceElement = document.createElement('span');
                sqmPriceElement.classList.add('sqm-price-display');
				
Kleinanzeigen m² Preis Rechner, Farbkodierer & Seitennavigation V6.2
Zeigt €/m², färbt Anzeigen dynamisch (basierend auf regional gespeicherten Preisen nach 3-stelligem PLZ-Präfix), Seitennavigation mit 'a'/'d'. Mit Löschbestätigung.

Version vom 5. Juni. Aktuellste Version

Skript installieren?
Stellen Sie eine Frage, veröffentlichen Sie eine Bewertung oder melden Sie das Skript.
Wrap lines
// ==UserScript==
// @name         Kleinanzeigen m² Preis Rechner, Farbkodierer & Seitennavigation V6.2 
// @namespace    http://tampermonkey.net/
// @version      1.7.2
// @description  Zeigt €/m², färbt Anzeigen dynamisch (basierend auf regional gespeicherten Preisen nach 3-stelligem PLZ-Präfix), Seitennavigation mit 'a'/'d'. Mit Löschbestätigung.
// @author       Dein Name
// @license MIT
// @match        https://www.kleinanzeigen.de/s-wohnung-mieten/*
// @match        https://www.kleinanzeigen.de/s-haus-mieten/*
// @match        https://www.kleinanzeigen.de/s-wohnung-kaufen/*
// @match        https://www.kleinanzeigen.de/s-haus-kaufen/*
// @match        https://www.kleinanzeigen.de/s-wg-zimmer/*
// @match        https://www.kleinanzeigen.de/s-immobilien/*
// @match        https://www.kleinanzeigen.de/s-grundstuecke-gaerten/*
// @grant        GM_addStyle
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_deleteValue
// @grant        GM_registerMenuCommand
// @run-at       document-idle
// ==/UserScript==
 
(function() {
    'use strict';
 
    const REGIONAL_STORAGE_KEY = 'kleinanzeigenRegionalSqmPrices_3digit';
    const PLZ_PREFIX_LENGTH = 3;
    let globalSqmPricesByRegion = loadRegionalSqmPrices();
 
    GM_addStyle(`
        .sqm-price-display { font-size: 1.4em; color: #20242C; font-weight: bold; margin-left: 10px; }
        /* ... Rest des CSS unverändert ... */
        .aditem-main--middle--price-shipping { display: flex; align-items: baseline; flex-wrap: wrap; }
        .sqm-price-container { margin-left: auto; padding-left: 5px; }
        .sqm-price-low { background-color: rgba(144, 238, 144, 0.4) !important; }
        .sqm-price-medium { background-color: rgba(255, 210, 100, 0.4) !important; }
        .sqm-price-high { background-color: rgba(255, 127, 127, 0.4) !important; }
        .sqm-price-uniform { background-color: rgba(200, 200, 200, 0.3) !important; }
    `);
 
    function loadRegionalSqmPrices() {
        return GM_getValue(REGIONAL_STORAGE_KEY, {});
    }
 
    function saveRegionalSqmPrices() {
        GM_setValue(REGIONAL_STORAGE_KEY, globalSqmPricesByRegion);
    }
 
    function calculateStorageInfo(data) {
        const jsonString = JSON.stringify(data);
        const sizeBytes = new TextEncoder().encode(jsonString).length;
        const sizeMegabytes = (sizeBytes / (1024 * 1024)).toFixed(4); // Etwas mehr Genauigkeit für kleine MB-Werte
 
        let totalAdEntries = 0;
        for (const region in data) {
            if (data.hasOwnProperty(region)) {
                totalAdEntries += Object.keys(data[region]).length;
            }
        }
        return { sizeMegabytes, totalAdEntries };
    }
 
    function confirmAndClearAllRegionalSqmPrices() {
        const currentData = GM_getValue(REGIONAL_STORAGE_KEY, {}); // Aktuelle Daten für Info holen
        const { sizeMegabytes, totalAdEntries } = calculateStorageInfo(currentData);
 
        const confirmationMessage = `Möchten Sie wirklich alle gespeicherten regionalen m² Preisdaten löschen?\n\n` +
                                  `Anzahl der erfassten Anzeigen: ${totalAdEntries}\n` +
                                  `Geschätzte Speichergröße: ${sizeMegabytes} MB\n\n` +
                                  `Diese Aktion kann nicht rückgängig gemacht werden.`;
 
        if (confirm(confirmationMessage)) { // confirm() zeigt OK/Abbrechen Dialog
            GM_deleteValue(REGIONAL_STORAGE_KEY);
            globalSqmPricesByRegion = {}; // Internen Speicher auch leeren
            alert('Alle gespeicherten regionalen m² Preise (3-stellig PLZ) wurden gelöscht. Die Farbanzeige wird zurückgesetzt.');
            processAdItems(); // Neu einfärben (jetzt nur basierend auf aktueller Seite oder leer)
        } else {
            alert('Löschvorgang abgebrochen.');
        }
    }
 
    GM_registerMenuCommand("Alle regionalen m² Preise (3-stellig PLZ) löschen...", confirmAndClearAllRegionalSqmPrices, "L");
    // Der Titel des Menübefehls hat jetzt "..." um anzudeuten, dass eine weitere Interaktion folgt.
 
 
 
 Der intelligente Flächen-Preisrechner für Kleinanzeigen 🏡
Zeigt €/m², färbt Anzeigen dynamisch (basierend auf regional gespeicherten Preisen nach 3-stelligem PLZ-Präfix), Seitennavigation mit 'a'/'d'. Mit Löschbestätigung.

Version vom 8. Juni. Aktuellste Version

Skript installieren?
Stellen Sie eine Frage, veröffentlichen Sie eine Bewertung oder melden Sie das Skript.
Wrap lines
// ==UserScript==
// @name         Der intelligente Flächen-Preisrechner für Kleinanzeigen 🏡
// @namespace    http://tampermonkey.net/
// @version      1.8
// @description  Zeigt €/m², färbt Anzeigen dynamisch (basierend auf regional gespeicherten Preisen nach 3-stelligem PLZ-Präfix), Seitennavigation mit 'a'/'d'. Mit Löschbestätigung.
// @author       Dein Name
// @license MIT
// @match        https://www.kleinanzeigen.de/s-wohnung-mieten/*
// @match        https://www.kleinanzeigen.de/s-haus-mieten/*
// @match        https://www.kleinanzeigen.de/s-wohnung-kaufen/*
// @match        https://www.kleinanzeigen.de/s-haus-kaufen/*
// @match        https://www.kleinanzeigen.de/s-wg-zimmer/*
// @match        https://www.kleinanzeigen.de/s-immobilien/*
// @match        https://www.kleinanzeigen.de/s-grundstuecke-gaerten/*
// @grant        GM_addStyle
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_deleteValue
// @grant        GM_registerMenuCommand
// @run-at       document-idle
// ==/UserScript==
 
(function() {
    'use strict';
 
    const REGIONAL_STORAGE_KEY = 'kleinanzeigenRegionalSqmPrices_3digit';
    const PLZ_PREFIX_LENGTH = 3;
    let globalSqmPricesByRegion = loadRegionalSqmPrices();
 
    GM_addStyle(`
        .sqm-price-display { font-size: 1.4em; color: #20242C; font-weight: bold; margin-left: 10px; }
        /* ... Rest des CSS unverändert ... */
        .aditem-main--middle--price-shipping { display: flex; align-items: baseline; flex-wrap: wrap; }
        .sqm-price-container { margin-left: auto; padding-left: 5px; }
        .sqm-price-low { background-color: rgba(144, 238, 144, 0.4) !important; }
        .sqm-price-medium { background-color: rgba(255, 210, 100, 0.4) !important; }
        .sqm-price-high { background-color: rgba(255, 127, 127, 0.4) !important; }
        .sqm-price-uniform { background-color: rgba(200, 200, 200, 0.3) !important; }
    `);
 
    function loadRegionalSqmPrices() {
        return GM_getValue(REGIONAL_STORAGE_KEY, {});
    }
 
    function saveRegionalSqmPrices() {
        GM_setValue(REGIONAL_STORAGE_KEY, globalSqmPricesByRegion);
    }
 
    function calculateStorageInfo(data) {
        const jsonString = JSON.stringify(data);
        const sizeBytes = new TextEncoder().encode(jsonString).length;
        const sizeMegabytes = (sizeBytes / (1024 * 1024)).toFixed(4); // Etwas mehr Genauigkeit für kleine MB-Werte
 
        let totalAdEntries = 0;
        for (const region in data) {
            if (data.hasOwnProperty(region)) {
                totalAdEntries += Object.keys(data[region]).length;
            }
        }
        return { sizeMegabytes, totalAdEntries };
    }
 
    function confirmAndClearAllRegionalSqmPrices() {
        const currentData = GM_getValue(REGIONAL_STORAGE_KEY, {}); // Aktuelle Daten für Info holen
        const { sizeMegabytes, totalAdEntries } = calculateStorageInfo(currentData);
 
        const confirmationMessage = `Möchten Sie wirklich alle gespeicherten regionalen m² Preisdaten löschen?\n\n` +
                                  `Anzahl der erfassten Anzeigen: ${totalAdEntries}\n` +
                                  `Geschätzte Speichergröße: ${sizeMegabytes} MB\n\n` +
                                  `Diese Aktion kann nicht rückgängig gemacht werden.`;
 
        if (confirm(confirmationMessage)) { // confirm() zeigt OK/Abbrechen Dialog
            GM_deleteValue(REGIONAL_STORAGE_KEY);
            globalSqmPricesByRegion = {}; // Internen Speicher auch leeren
            alert('Alle gespeicherten regionalen m² Preise (3-stellig PLZ) wurden gelöscht. Die Farbanzeige wird zurückgesetzt.');
            processAdItems(); // Neu einfärben (jetzt nur basierend auf aktueller Seite oder leer)
        } else {
            alert('Löschvorgang abgebrochen.');
        }
    }
 
    GM_registerMenuCommand("Alle regionalen m² Preise (3-stellig PLZ) löschen...", confirmAndClearAllRegionalSqmPrices, "L");
    // Der Titel des Menübefehls hat jetzt "..." um anzudeuten, dass eine weitere Interaktion folgt.
 
    function parsePrice(priceString) { /* ... unverändert ... */ }
	
	Der intelligente Flächen-Preisrechner für Kleinanzeigen 🏡
Zeigt €/m², färbt Anzeigen dynamisch (basierend auf regional gespeicherten Preisen nach 3-stelligem PLZ-Präfix), Seitennavigation mit 'a'/'d'. Mit Löschbestätigung.

Version vom 8. Juni. Aktuellste Version

Skript installieren?
Stellen Sie eine Frage, veröffentlichen Sie eine Bewertung oder melden Sie das Skript.
Wrap lines
// ==UserScript==
// @name         Der intelligente Flächen-Preisrechner für Kleinanzeigen 🏡
// @namespace    http://tampermonkey.net/
// @version      2.0
// @description  Zeigt €/m², färbt Anzeigen dynamisch (basierend auf regional gespeicherten Preisen nach 3-stelligem PLZ-Präfix), Seitennavigation mit 'a'/'d'. Mit Löschbestätigung.
// @author       Dein Name
// @license MIT
// @icon         https://t1.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=http://kleinanzeigen.de&size=64
// @match        https://www.kleinanzeigen.de/s-wohnung-mieten/*
// @match        https://www.kleinanzeigen.de/s-haus-mieten/*
// @match        https://www.kleinanzeigen.de/s-wohnung-kaufen/*
// @match        https://www.kleinanzeigen.de/s-haus-kaufen/*
// @match        https://www.kleinanzeigen.de/s-wg-zimmer/*
// @match        https://www.kleinanzeigen.de/s-immobilien/*
// @match        https://www.kleinanzeigen.de/s-grundstuecke-gaerten/*
// @grant        GM_addStyle
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_deleteValue
// @grant        GM_registerMenuCommand
// @run-at       document-idle
// ==/UserScript==
 
(function() {
    'use strict';
 
    const REGIONAL_STORAGE_KEY = 'kleinanzeigenRegionalSqmPrices_3digit';
    const PLZ_PREFIX_LENGTH = 3;
    let globalSqmPricesByRegion = loadRegionalSqmPrices();
 
    GM_addStyle(`
        .sqm-price-display { font-size: 1.4em; color: #20242C; font-weight: bold; margin-left: 10px; }
        /* ... Rest des CSS unverändert ... */
        .aditem-main--middle--price-shipping { display: flex; align-items: baseline; flex-wrap: wrap; }
        .sqm-price-container { margin-left: auto; padding-left: 5px; }
        .sqm-price-low { background-color: rgba(144, 238, 144, 0.4) !important; }
        .sqm-price-medium { background-color: rgba(255, 210, 100, 0.4) !important; }
        .sqm-price-high { background-color: rgba(255, 127, 127, 0.4) !important; }
        .sqm-price-uniform { background-color: rgba(200, 200, 200, 0.3) !important; }
    `);
 
    function loadRegionalSqmPrices() {
        return GM_getValue(REGIONAL_STORAGE_KEY, {});
    }
 
    function saveRegionalSqmPrices() {
        GM_setValue(REGIONAL_STORAGE_KEY, globalSqmPricesByRegion);
    }
 
    function calculateStorageInfo(data) {
        const jsonString = JSON.stringify(data);
        const sizeBytes = new TextEncoder().encode(jsonString).length;
        const sizeMegabytes = (sizeBytes / (1024 * 1024)).toFixed(4); // Etwas mehr Genauigkeit für kleine MB-Werte
 
        let totalAdEntries = 0;
        for (const region in data) {
            if (data.hasOwnProperty(region)) {
                totalAdEntries += Object.keys(data[region]).length;
            }
        }
        return { sizeMegabytes, totalAdEntries };
    }
 
    function confirmAndClearAllRegionalSqmPrices() {
        const currentData = GM_getValue(REGIONAL_STORAGE_KEY, {}); // Aktuelle Daten für Info holen
        const { sizeMegabytes, totalAdEntries } = calculateStorageInfo(currentData);
 
        const confirmationMessage = `Möchten Sie wirklich alle gespeicherten regionalen m² Preisdaten löschen?\n\n` +
                                  `Anzahl der erfassten Anzeigen: ${totalAdEntries}\n` +
                                  `Geschätzte Speichergröße: ${sizeMegabytes} MB\n\n` +
                                  `Diese Aktion kann nicht rückgängig gemacht werden.`;
 
        if (confirm(confirmationMessage)) { // confirm() zeigt OK/Abbrechen Dialog
            GM_deleteValue(REGIONAL_STORAGE_KEY);
            globalSqmPricesByRegion = {}; // Internen Speicher auch leeren
            alert('Alle gespeicherten regionalen m² Preise (3-stellig PLZ) wurden gelöscht. Die Farbanzeige wird zurückgesetzt.');
            processAdItems(); // Neu einfärben (jetzt nur basierend auf aktueller Seite oder leer)
        } else {
            alert('Löschvorgang abgebrochen.');
        }
    }
 
 Kleinanzeigen Mietdashboard V8.2 (Final Anchor Fix)
Dashboard mit präzisem Anker, robustere Parser, €/m², Werbeblocker #komplett refaktoriert

Version vom vor 3 Wochen. Aktuellste Version

Skript installieren?
Stellen Sie eine Frage, veröffentlichen Sie eine Bewertung oder melden Sie das Skript.
Wrap lines
// ==UserScript==
// @name         Kleinanzeigen Mietdashboard V8.2 (Final Anchor Fix)
// @namespace    http://tampermonkey.net/
// @version      8.2
// @license MIT
// @description  Dashboard mit präzisem Anker, robustere Parser, €/m², Werbeblocker #komplett refaktoriert 
// @author       Deine KI-Assistenz
// @match        https://www.kleinanzeigen.de/s-wohnung-mieten/*
// @grant        GM_addStyle
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_deleteValue
// @grant        GM_registerMenuCommand
// @run-at       document-idle
// ==/UserScript==
 
(function() {
    'use strict';
 
    const CONFIG = {
        DASHBOARD_ANCHOR_SELECTOR: '.srp-header.l-container-row', // ❗ NEU: Dein exakter Ankerpunkt!
        AD_ITEM_SELECTOR: '.ad-listitem, article.aditem[data-adid]',
        STORAGE_KEY_PREFIX: 'ka_RegionalSqmPrices',
        PLZ_PREFIX_LENGTH: 3,
        DEBOUNCE_DELAY: 450,
        AD_SCRIPT_PATTERNS: [ /ads\.js/i, /advertisement\.js/i, /adservice/i, /googlesyndication\.com/i, /liberty.*\.js/i, /fbevent\.js/i, /teads.*\.js/i, /taboola.*\.js/i, /criteo.*\.js/i, /bat\.bing\.com/i, /hotjar.*\.js/i ],
        AD_ELEMENT_SELECTORS: [ '.site-base--left-banner', '.site-base--right-banner', '#banner-skyscraper', '.sticky-advertisement', 'div[id^="google_ads_iframe_"]', 'iframe[aria-label*="ad"]', '[data-liberty-position-name*="banner"]', '[aria-label*="Advertisement"]', '[aria-label*="Werbung"]', 'div[aria-label*="Gesponsert"]' ]
    };
 
    const KleinanzeigenOptimizer = {
        state: { lastUrl: location.href, regionalPrices: {}, plzLength: 3 },
        
        init() {
            this.state.plzLength = GM_getValue('plz_length', CONFIG.PLZ_PREFIX_LENGTH);
            this.injectStyles();
            this.blockScripts();
            this.registerMenuCommands();
            setTimeout(() => this.run(), 250); // Leicht erhöhter Start-Delay
            this.observeSPA();
            window.addEventListener('error', e => console.error('[KA-SCRIPT] Globaler JS-Fehler:', e.error, e));
        },
 
        run() {
            console.log('[KA-SCRIPT] Starte Analyse für:', location.href);
            try {
                this.removeAdElements();
                this.processAdItems();
                this.setupImgZoom();
            } catch(e) { console.error('[KA-SCRIPT] Ein schwerwiegender Fehler ist im run() aufgetreten:', e); }
        },
 
        injectStyles() {
             GM_addStyle(`
                :root { --ka-color-low: #38cb7f; --ka-color-low-bg: #ecfaed; --ka-color-mid: #ffd264; --ka-color-mid-bg: #fff8d2; --ka-color-high: #ff6363; --ka-color-high-bg: #fff1ef; --ka-price-color: #2342b2; --ka-border-color: #e3e9f1; }
                #ka-main-dashboard { margin: 0 0 16px 0; display:flex; gap:1.3em; background:#f4f7fb; border:2px solid var(--ka-border-color); border-radius:13px; box-shadow:0 2px 18px #2222; padding:1.2em 1.6em; align-items:center; flex-wrap:wrap; }
                .ka-dash-card { flex:1 1 0; text-align:center; border-radius:10px; background:#fff; margin:0 0.2em; padding:.9em .4em; box-shadow:0 1px 8px #2221; min-width:120px; }
                .ka-dash-card.ka-low { border-left:7px solid var(--ka-color-low); } .ka-dash-card.ka-mid { border-left:7px solid var(--ka-color-mid); } .ka-dash-card.ka-high { border-left:7px solid var(--ka-color-high); }
                .ka-dash-title { font-weight:700; font-size:1.13em; margin-bottom:6px; } .ka-dash-value { font-size:1.77em; margin:0 0 .3em 0; display:block; font-weight:bold; } .ka-dash-sub { color:#777;font-size:.97em;line-height:1.12 }
                #ka-dash-meta { font-size:.94em; color:#444; margin-top:6px; flex-basis:100%; text-align:center; } #ka-dash-clear-btn { margin-left:.7em;font-size:.98em;padding:.07em .55em; cursor:pointer; }
                .ka-sqm-wrap { text-align:right; } .ka-sqm-price-display { font-size:1.65em; color: var(--ka-price-color); font-weight:800; margin-left:.6em; background:#eef4fc; padding:2px 16px 2px 13px; border-radius:5px; float:none; display:inline-block; }
                article.aditem.ka-price-low, .ad-listitem.ka-price-low { background: var(--ka-color-low-bg) !important; } article.aditem.ka-price-mid, .ad-listitem.ka-price-mid { background: var(--ka-color-mid-bg) !important; } article.aditem.ka-price-high, .ad-listitem.ka-price-high { background: var(--ka-color-high-bg) !important; } article.aditem.ka-price-uniform, .ad-listitem.ka-price-uniform { background:#eee !important; }
                .ka-overlay-img { position:fixed; left:50%; top:50%; max-width:94vw; max-height:94vh; transform:translate(-50%,-50%); z-index:29999; border-radius:12px; box-shadow:0 8px 40px 0 rgba(0,0,0,0.72); background:#222; opacity:0; pointer-events:none; display:block; object-fit:contain; transition:opacity 0.16s cubic-bezier(.19,1,.22,1);}
            `);
        },
 
        injectDashboard(stats) {
            console.log('[KA-SCRIPT] Injiziere Dashboard mit folgenden Daten:', stats);
            document.getElementById('ka-main-dashboard')?.remove();
 
            // ❗ NEU: Direkter Anker, wie von dir vorgegeben, mit einem sicheren Fallback.
            const anchor = document.querySelector(CONFIG.DASHBOARD_ANCHOR_SELECTOR);